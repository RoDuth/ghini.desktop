image: Visual Studio 2019

platform:
  - x64

branches:
  only:
    - ghini-1.3-bbg

environment:
  MSYSTEM: MINGW64
  CHERE_INVOKING: 1
  PATH: C:\msys64\usr\bin;C:\Program Files (x86)\NSIS\Bin;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem

install:
  - bash -lc "pacman --noconfirm -Syuu"
  - bash -lc "pacman --noconfirm -Syuu"
  - bash -lc "pacman --noconfirm -Syuu"
  - bash -lc "pacman --noconfirm -S - < ./scripts/mingw64_pkglist.txt"

build_script:
  - bash -lc "pip install ."
  - bash -lc "pip install pyinstaller"
  - bash -lc "python -m PyInstaller --clean -w --noconfirm ghini.spec"
  - makensis scripts\build-multiuser.nsi

artifacts:
  - path: scripts/ghini.desktop-*-setup.exe

deploy:
  release: 'v1.3.0-a (BBG Branch)' # :bump
  description: 'Alpha release, backup your data first, use at own risk!'
  provider: GitHub
  auth_token:
    secure: m0gg+fMh1ot3TOipC0zQmOQNABEZUE5Xbkg6nR9Hl3kK05u/u0qcWkdJFIOHGeh3
  draft: false
  prerelease: true
  force_update: true

test_script:
  - bash -lc "BAUBLE_TEST=True nosetests --traverse-namespace -vv"
