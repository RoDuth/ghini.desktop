image: Visual Studio 2019

branches:
  only:
    - ghini-1.3-bbg

install:
  - C:\msys64\usr\bin\bash -lc "pacman --noconfirm -Syuu"
  - C:\msys64\usr\bin\bash -lc "pacman --noconfirm -Syuu"
  - $env:CHERE_INVOKING = 1
  - C:\msys64\usr\bin\bash -lc "pacman --noconfirm -S - < ./scripts/mingw64_pkglist.txt"

build_script:
  - ps: $env:CHERE_INVOKING = 1
  - ps: $env:MSYSTEM = 'MINGW64'
  - ps: C:\msys64\usr\bin\bash -lc "pip install ."
  - ps: C:\msys64\usr\bin\bash -lc "pip install pyinstaller"
  - ps: C:\msys64\usr\bin\bash -lc "python -m PyInstaller --clean -w --noconfirm ghini.spec"
  - ps: $env:PATH += ";C:\Program Files (x86)\NSIS\Bin"
  - ps: makensis scripts\build-multiuser.nsi

artifacts:
  - path: scripts/ghini.desktop-*-setup.exe

deploy:
  release: 'v1.3.0-a (BBG Branch)' # :bump
  description: 'This is an alpha release, backup your data first, use at own risk!'
  provider: GitHub
  auth_token:
    secure: m0gg+fMh1ot3TOipC0zQmOQNABEZUE5Xbkg6nR9Hl3kK05u/u0qcWkdJFIOHGeh3
  draft: false
  prerelease: false
  force_update: true

# can't seem to get this working in mingw64
test_script:
  - ps: C:\msys64\usr\bin\bash -lc "set BAUBLE_TEST=True nosetests"
